<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>/api/projects - QSA Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../custom.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">QSA Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/pblottiere/QSA" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="qsa-rest-api--apiprojects"><a class="header" href="#qsa-rest-api--apiprojects">QSA REST API : /api/projects</a></h1>
<h2 id="project"><a class="header" href="#project">Project</a></h2>
<p>A QSA project is defined by:</p>
<ul>
<li>a QGIS project</li>
<li>a list of themes</li>
<li>an internal SQLite database</li>
<li>a MapProxy configuration file (if enabled)</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>URL</th><th>Description</th></tr></thead><tbody>
<tr><td>GET</td><td><code>/api/projects</code></td><td>List projects</td></tr>
<tr><td>GET</td><td><code>/api/projects/{project}</code></td><td>List projectâ€™s metadata</td></tr>
<tr><td>POST</td><td><code>/api/projects/</code></td><td>Create a project with <code>name</code>, <code>author</code> and <code>schema</code> (only used when PostgreSQL support is enabled)</td></tr>
<tr><td>DELETE</td><td><code>/api/projects/{project}</code></td><td>Remove a project</td></tr>
</tbody></table>
</div>
<p>Examples:</p>
<pre><code class="language-console"># create a project and store the QGIS project in PostgreSQL within `my_schema`
$ curl "http://localhost/api/projects/" \
     -X POST \
     -H 'Content-Type: application/json' \
     -d '{
        "name":"my_project",
        "author":"pblottiere",
        "schema":"my_schema"
     }'

# get metadata about the project stored in PostgreSQL
$ curl "http://localhost/api/projects/my_project?schema=my_schema"
</code></pre>
<h2 id="layer"><a class="header" href="#layer">Layer</a></h2>
<p>When a layer is added/removed to a QSA project, the corresponding QGIS project
is updated. When MapProxy cache management is enabled, the configuration file is
updated as well and the cache may be cleaned if necessary (for example when the
current style is updated).</p>
<p>Several themes can be associated with a layer like in QGIS Desktop, but only
the current one is used when the <code>STYLE</code> parameter in OGC web services is
empty.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>URL</th><th>Description</th></tr></thead><tbody>
<tr><td>GET</td><td><code>/api/projects/{project}/layers</code></td><td>List layers in project</td></tr>
<tr><td>GET</td><td><code>/api/projects/{project}/layers/{layer}</code></td><td>List layerâ€™s metadata</td></tr>
<tr><td>GET</td><td><code>/api/projects/{project}/layers/{layer}/map</code></td><td>WMS <code>GetMap</code> result with default parameters</td></tr>
<tr><td>GET</td><td><code>/api/projects/{project}/layers/{layer}/map/url</code></td><td>WMS <code>GetMap</code> URL with default parameters</td></tr>
<tr><td>POST</td><td><code>/api/projects/{project}/layers</code></td><td>Add layer to project. See <a href="#layer-definition">Layer definition</a> for more information.</td></tr>
<tr><td>POST</td><td><code>/api/projects/{project}/layers/{layer}/style</code></td><td>Add/Update layerâ€™s style with <code>name</code> (style name) and <code>current</code> (<code>true</code> or <code>false</code>)</td></tr>
<tr><td>DELETE</td><td><code>/api/projects/{project}/layers/{layer}</code></td><td>Remove layer from project</td></tr>
</tbody></table>
</div>
<h3 id="layer-definition"><a class="header" href="#layer-definition">Layer definition</a></h3>
<p>A layer can be added to a project thanks to the next parameters:</p>
<ul>
<li><code>type</code> : <code>raster</code> or <code>vector</code></li>
<li><code>name</code> : the layerâ€™s name</li>
<li><code>datasource</code> : the link to the datasource according to the storage backend
<ul>
<li>filesystem : <code>/tmp/raster.tif</code></li>
<li>AWS S3 : <code>/vsis3/bucket/raster.tif</code></li>
<li>PostGIS : <code>service=qsa table=\"public\".\"lines\" (geom)</code></li>
</ul>
</li>
<li><code>overview</code> (optional) : automatically build overviews for raster layers stored in S3 buckets</li>
<li><code>crs</code> (optional) : CRS (automatically detected by default)</li>
</ul>
<p>Example:</p>
<pre><code class="language-console"># Add a FlatGeobuf vector layer stored on S3 bucket in project `my_project`
$ curl "http://localhost/api/projects/my_project/layers" \
  -X POST \
  -H 'Content-Type: application/json' \
  -d '{
    "name":"my_layer",
    "type":"vector",
    "datasource":"/vsis3/my-storage/vector/my_layer.fgb"
  }'
</code></pre>
<h2 id="style"><a class="header" href="#style">Style</a></h2>
<p>A QSA style may be used through the <code>STYLE</code> OGC web services parameter to
specify the rendering for a specific layer. Default styles may be defined and
automatically used when a vector layer is added to a QSA project.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>URL</th><th>Description</th></tr></thead><tbody>
<tr><td>GET</td><td><code>/api/projects/{project}/styles</code></td><td>List styles in project</td></tr>
<tr><td>GET</td><td><code>/api/projects/{project}/styles/default</code></td><td>List default styles in project</td></tr>
<tr><td>GET</td><td><code>/api/projects/{project}/styles/{style}</code></td><td>List styleâ€™s metadata</td></tr>
<tr><td>POST</td><td><code>/api/projects/{project}/styles/{style}</code></td><td>Add style to project. See <a href="#vector-style">Vector style</a> and <a href="#raster-style">Raster style</a> for more information.</td></tr>
<tr><td>POST</td><td><code>/api/projects/{project}/styles/default</code></td><td>Set a default layerâ€™s style. See <a href="#vector-style">Vector style</a> and <a href="#raster-style">Raster style</a> for more information.</td></tr>
<tr><td>DELETE</td><td><code>/api/projects/{project}/styles/{style}</code></td><td>Remove style from project</td></tr>
</tbody></table>
</div>
<h3 id="vector-style"><a class="header" href="#vector-style">Vector style</a></h3>
<p>For vector layers, a style can be defined with the parameters listed below:</p>
<ul>
<li><code>type</code> : <code>vector</code></li>
<li><code>name</code> : the name of the style</li>
<li><code>rendering</code> : rendering parameters (only <code>opacity</code> is supported for now)</li>
<li><code>symbology</code> : dictionary with <code>type</code> (only <code>single_symbol</code> is supported for
now), <code>symbol</code> and <code>properties</code></li>
</ul>
<p>Example:</p>
<pre><code class="language-console"># Add a style for point geometry vector layers
$ curl "http://localhost:5000/api/projects/my_project/styles" \
  -X POST \
  -H 'Content-Type: application/json' \
  -d '{
    "type": "vector",
    "name": "my_marker_style",
    "rendering": {
      "opacity": 100.
    },
    "symbology": {
      "type": "single_symbol",
      "symbol": "marker",
      "properties": {
        "color": "#112233"
      }
    }
  }'
</code></pre>
<p>To set a default style for a specific geometry, the parameters listed below are available:</p>
<ul>
<li><code>name</code> : the name of the style to use by default</li>
<li><code>geometry</code> : the geometry for which the style needs to be applied</li>
</ul>
<h4 id="raster-style"><a class="header" href="#raster-style">Raster style</a></h4>
<p>For raster layers, a style can be defined with the parameters listed below:</p>
<ul>
<li><code>type</code> : <code>raster</code></li>
<li><code>name</code> : the name of the style</li>
<li><code>rendering</code> : rendering parameters</li>
<li><code>symbology</code> : dictionary with <code>type</code> (only <code>singlebandgray</code> and
<code>multibandcolor</code> are supported for now) and <code>properties</code></li>
</ul>
<p>Example:</p>
<pre><code class="language-console"># Add a style for multiband raster
$ curl "http://localhost:5000/api/projects/my_project/styles" \
  -X POST \
  -H 'Content-Type: application/json' \
  -d '{
    "type": "raster",
    "name": "my_multiband_style",
    "rendering": {
      "saturation": 3,
      "brightness": -148,
      "contrast": 42,
      "gamma": 4.
    },
    "symbology": {
      "type": "multibandcolor",
      "properties": {
        "red": {
          "band": 1
        },
        "green": {
          "band": 2
        },
        "blue": {
          "band": 3
        }
      }
    }
  }'
</code></pre>
<h2 id="cache"><a class="header" href="#cache">Cache</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>URL</th><th>Description</th></tr></thead><tbody>
<tr><td>GET</td><td><code>/api/projects/{project}/cache</code></td><td>Return metadata about the cache</td></tr>
<tr><td>POST</td><td><code>/api/projects/{project}/cache/reset</code></td><td>Clear cached data and reset cache configuration</td></tr>
</tbody></table>
</div>
<p>Example:</p>
<pre><code class="language-console">$ curl "http://localhost:5000/api/projects/my_project/cache"
{
  "valid":true,
  "storage":"filesystem"
}
</code></pre>
<div class="warning">
Reset cache
<p>When a QGIS project is created manually without QSA, the cache is not
initialized. This method allows to create the MapProxy configuration file
accordingly.</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../qsa-api/endpoints/symbology.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../qsa-api/endpoints/processing.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../qsa-api/endpoints/symbology.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../qsa-api/endpoints/processing.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
